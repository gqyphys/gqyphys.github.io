---
layout:     post
title:      "Redis安装及使用"
subtitle:   ""
date:       2017-03-13 00:00:00
author:     "alvy"
header-img: "img/post-bg-database1.jpg"
header-mask: 0.3
catalog:    true
tags:
    - cache
    - Redis
---

##### redis服务安装    

安装参考链接：[http://redis.io/download](http://redis.io/download)

```shell
$ wget http://download.redis.io/releases/redis-3.2.6.tar.gz
$ tar xzf redis-3.2.6.tar.gz
$ cd redis-3.2.6
$ make
```

一般安装路径放在`/usr/local/`下

##### 启动与关闭    

启动服务的命令是    

```
$ /usr/local/redis/src/redis-server
```

CTRL+Z之后输入bg，让服务在后台运行    

然后就可以进去客户端了,命令是    

```
$ /usr/local/redis/src/redis-cli
```

可以加上ip和端口`-h <i> -p <port>`    

> 启动服务之后，进入客户端，发现没有反应，那么请参照这里：   [http://unix.stackexchange.com/questions/103731/run-a-command-without-making-me-wait](http://unix.stackexchange.com/questions/103731/run-a-command-without-making-me-wait)    

服务启动关闭重启也可参照这里：    

[http://stackoverflow.com/questions/6910378/how-can-i-stop-redis-server](http://stackoverflow.com/questions/6910378/how-can-i-stop-redis-server)    

```
$ /etc/init.d/redis-server restart
$ /etc/init.d/redis-server stop
$ /etc/init.d/redis-server start
```
##### 配置    

上面的服务启动命令是以默认的配置启动，我们也可以以自己的配置来启动，配置设置的含义可以参照这里：    

[http://www.runoob.com/redis/redis-conf.html](http://www.runoob.com/redis/redis-conf.html)    

官网也有配置示例，可在`/etc/`下创建redis.conf文件，然后将示例粘贴进去，在此基础上修改

一般我们需要设置ip，让别的服务器连接

```
bind 10.174.93.111
```

然后我们启动服务的时候需要加上配置，启动命令如下：    

```shell
$ /usr/local/redis-3.2.3/src/redis-server /etc/redis.conf  --protected-mode no
```

进入客户端的时候也需要加上ip    

```shell
$ /usr/local/redis-3.2.3/src/redis-cli -h 10.174.93.111
```
##### 在Python Flask应用里配置Redis    

我们采用python的redis包，参照[https://pypi.python.org/pypi/redis](https://pypi.python.org/pypi/redis)

配置文件：    

```
REDIS_HOST = "10.174.93.111"
REDIS_PORT = 6379
REDIS_DATABASE = 0
```

创建redis实例    

```
redis_celery_conn = redis.StrictRedis(host=config.REDIS_HOST,port=config.REDIS_PORT,db=config.REDIS_DATABASE)
```

运行测试：    

```shell
>>> from ksxing.store import redis_celery_conn as redis_clr
>>> redis_clr.set('foo','bar')
True
>>> redis_clr.get('foo')
'bar'
```

 import redis实例时可能会出现错误    

`redis.exceptions.ResponseError: DENIED Redis is running in protected mode because protected mode is enabled`    

原因参照这里：[http://www.cnblogs.com/leolztang/p/5542747.html](http://www.cnblogs.com/leolztang/p/5542747.html)    

简单的说有两个原因：1. 没有设置密码；2. 没有绑定ip